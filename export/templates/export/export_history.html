{% extends 'datacollection/layout.html' %}
{% load custom_filters %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  .swal2-popup {
    font-family: inherit;
    border-radius: 0.5rem;
  }
  .dark .swal2-popup {
    background: #1e293b;
    color: white;
  }
  .dark .swal2-title {
    color: white;
  }
  .dark .swal2-content {
    color: #e2e8f0;
  }
  .swal2-confirm {
    margin-right: 10px;
  }

  /* Filter Styling */
  .filter-container {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .filter-select, .filter-input {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(5px);
    transition: all 0.3s ease;
  }

  .filter-select:focus, .filter-input:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .filter-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: all 0.3s ease;
    transform: translateY(0);
  }

  .filter-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
  }

  .clear-btn {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    transition: all 0.3s ease;
  }

  .clear-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
  }

  /* Status badges */
  .status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-completed {
    background: #ecfdf5;
    color: #10b981;
  }

  .status-processing {
    background: #fef3c7;
    color: #f59e0b;
  }

  .status-failed {
    background: #fef2f2;
    color: #ef4444;
  }

  .status-pending {
    background: #f3f4f6;
    color: #6b7280;
  }

  .status-cancelled {
    background: #f3f4f6;
    color: #6b7280;
  }

  /* Table styling */
  .export-table th,
  .export-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
  }

  .export-table th {
    background: #f9fafb;
    font-weight: 600;
    color: #374151;
  }

  .export-table tr:hover {
    background: #f9fafb;
  }

  /* Action buttons */
  .action-btn {
    padding: 0.375rem 0.75rem;
    border: none;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .btn-download {
    background: #10b981;
    color: white;
  }

  .btn-download:hover {
    background: #059669;
    transform: translateY(-1px);
  }

  .btn-details {
    background: #3b82f6;
    color: white;
    margin-left: 0.5rem;
  }

  .btn-details:hover {
    background: #2563eb;
    transform: translateY(-1px);
  }

  /* Details modal styling */
  .export-details {
    margin-top: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    padding: 0.25rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .detail-row:last-child {
    border-bottom: none;
    margin-bottom: 0;
  }

  .detail-label {
    font-weight: 500;
    color: #374151;
  }

  .detail-value {
    color: #6b7280;
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
  }

  .file-size {
    font-weight: 600;
    color: #10b981;
  }

  .duration {
    color: #667eea;
  }

  .error-message {
    color: #ef4444;
    background: #fef2f2;
    padding: 0.5rem;
    border-radius: 4px;
    margin-top: 0.5rem;
    font-size: 0.875rem;
  }

  .filters-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .filter-tag {
    background: #e5e7eb;
    color: #374151;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
  }

  .progress-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #f59e0b;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Refresh button */
  .refresh-btn {
    padding: 0.5rem 1rem;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.875rem;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
  }

  .refresh-btn:hover {
    background: #5568d3;
    transform: translateY(-1px);
  }

  .refresh-btn i {
    margin-right: 0.5rem;
  }

  /* No exports styling */
  .no-exports {
    text-align: center;
    padding: 3rem;
    color: #6b7280;
  }

  .no-exports i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    opacity: 0.5;
  }

  /* Filter tags display */
  .filter-tag-display {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 500;
    margin: 0.25rem;
  }

  .filter-tag-display button {
    background: none;
    border: none;
    color: white;
    margin-left: 0.5rem;
    cursor: pointer;
    font-size: 1rem;
    line-height: 1;
  }
</style>
{% endblock %}

{% block content %}
  <nav>
    <!-- breadcrumb -->
    <ol style="margin-bottom: 30px;" class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
      <li class="text-sm leading-normal">
        <a class="text-white opacity-50" href="javascript:;">home</a>
      </li>
      <li class="text-sm pl-2 capitalize leading-normal text-white before:float-left before:pr-2 before:text-white before:content-['/']" aria-current="page">export history</li>
    </ol>

    <div class="flex flex-row justify-between">
      <h6 class="mb-0 font-bold text-white capitalize">Export History</h6>
      <a href="{% url 'export:export_with_audio' %}" class="inline-block px-5 py-2.5 font-bold leading-normal text-center text-white align-middle transition-all bg-slate-700 border-0 rounded-lg cursor-pointer text-sm ease-in shadow-md bg-150hover:shadow-xs active:opacity-85 hover:-translate-y-px tracking-tight-rem bg-x-25">
        <i class="fas fa-plus" aria-hidden="true"></i>&nbsp;&nbsp;Create New Export
      </a>
    </div>
  </nav>

  <!-- row 1 -->
  <div class="flex flex-wrap -mx-3">
    <!-- card1 -->
    <div class="w-full px-6 py-6 mx-auto">
      <!-- table 1 -->
      <div class="flex flex-wrap -mx-3">
        <div class="flex-none w-full max-w-full px-3">
          <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 border-transparent border-solid shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
            {% if messages %}
            <div class="fixed top-4 right-4 z-50 w-full max-w-xs">
              {% for message in messages %}
              <div class="alert alert-{{ message.tags }} mb-4 p-4 rounded-lg shadow-lg border-l-4 {% if message.tags == 'success' %}bg-green-100 border-green-500 text-green-700{% elif message.tags == 'error' %}bg-red-100 border-red-500 text-red-700{% else %}bg-blue-100 border-blue-500 text-blue-700{% endif %}">
                <div class="flex items-center">
                  <span class="mr-2">
                    {% if message.tags == 'success' %}
                    <i class="fas fa-check-circle"></i>
                    {% elif message.tags == 'error' %}
                    <i class="fas fa-exclamation-circle"></i>
                    {% else %}
                    <i class="fas fa-info-circle"></i>
                    {% endif %}
                  </span>
                  <span>{{ message }}</span>
                  <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-lg">&times;</button>
                </div>
              </div>
              {% endfor %}
            </div>
            {% endif %}
            <div class="p-6 pb-0 mb-0 border-b-0 border-b-solid rounded-t-2xl border-b-transparent">
              <div class="flex justify-between items-center">
                <h6 class="dark:text-white text-xl">Export History</h6>
                <h6 class=" text-gray-500 dark:text-gray-400">
                  Total: {{ paginator.count }} exports
                </h6>
              </div>
            </div>

            <!-- Advanced Filters -->
            <div class="filter-container rounded-2xl p-6  backdrop-blur-lg">
              <form method="GET" class="space-y-4">
                <div class="flex flex-wrap items-center gap-4">
                  <!-- Search Input -->
                  <div  style="min-width: 120px;" style="margin-bottom: 3px;" class="flex-1 min-w-64">
                    <div class="relative flex flex-wrap items-stretch w-full transition-all rounded-lg ease">
                      <span class="text-sm ease leading-5.6 absolute z-50 -ml-px flex h-full items-center whitespace-nowrap rounded-lg rounded-tr-none rounded-br-none border border-r-0 border-transparent bg-transparent py-2 px-2.5 text-center font-normal text-slate-500 transition-all">
                        <i class="fas fa-search" aria-hidden="true"></i>
                      </span>
                      <input
                        type="text"
                        name="search"
                        value="{{ current_filters.search|default:'' }}"
                        placeholder="Search by Export Name..."
                        class="pl-9 text-sm filter-input  focus:shadow-primary-outline ease w-1/100 leading-5.6 relative -ml-px block min-w-0 flex-auto rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 pr-3 text-gray-700 transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:transition-shadow" placeholder="Type here..."
                      />
                    </div>
                  </div>

                  <!-- Status Filter -->
                  <div class="min-w-40  mr-2" style="margin-bottom: 3px;">
                    <select name="status" class="focus:shadow-primary-outline text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none">
                      <option value="">All Status</option>
                      <option value="pending" {% if current_filters.status == 'pending' %}selected{% endif %}>Pending</option>
                      <option value="processing" {% if current_filters.status == 'processing' %}selected{% endif %}>Processing</option>
                      <option value="completed" {% if current_filters.status == 'completed' %}selected{% endif %}>Completed</option>
                      <option value="failed" {% if current_filters.status == 'failed' %}selected{% endif %}>Failed</option>
                      <option value="cancelled" {% if current_filters.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                  </div>

                  <!-- Page Size Selector -->
                  <div class="mr-2" style="margin-bottom: 3px;">
                    <select name="page_size" class="filter-select focus:shadow-primary-outline text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none">
                      <option value="50" {% if current_filters.page_size == '50' %}selected{% endif %}>50 per page</option>
                      <option value="100" {% if current_filters.page_size == '100' %}selected{% endif %}>100 per page</option>
                      <option value="200" {% if current_filters.page_size == '200' or not current_filters.page_size %}selected{% endif %}>200 per page</option>
                      <option value="300" {% if current_filters.page_size == '300' %}selected{% endif %}>300 per page</option>
                    </select>
                  </div>

                  <!-- Filter Buttons -->
                  <div class="flex gap-2" >
                    <button type="submit" class="filter-btn px-6 py-2.5 mr-2 border border-primary  rounded-lg text-primary font-medium">
                      <i class="fas fa-filter mr-2"></i>Filter
                    </button>
                    <a href="{% url 'export:export_history' %}" class="clear-btn px-6    border border-red-600 rounded-lg text-red-600 font-medium inline-flex items-center">
                      <i class="fas fa-times mr-2"></i>Clear
                    </a>
                  </div>
                </div>

                <!-- Active Filters Display -->
                <div style="margin-top: 20px;" class="flex flex-wrap items-center">
                  {% if current_filters.search %}
                  <div style="font-size: 12px;" class="filter-tag-display border  rounded-lg px-1 py-1 text-primary border-primary">
                      Search: {{ current_filters.search }}
                      <button  style="font-size: 16px;" type="button" onclick="clearFilter('search')">&times;</button>
                  </div>
                  {% endif %}
                  {% if current_filters.status %}
                    <div style="font-size: 12px;" class="filter-tag-display border  rounded-lg px-1 py-1 text-primary border-primary">
                      Status: {{ current_filters.status|title }}
                      <button type="button" onclick="clearFilter('status')">&times;</button>
                    </div>
                  {% endif %}
                </div>
              </form>
            </div>

            <div class="flex-auto px-0 pt-0 pb-2">
              <div class="p-0 overflow-x-auto">
                <table class="items-center w-full mb-0 align-top border-collapse dark:border-white/40 text-slate-500">
                  <thead class="align-bottom">
                    <tr>
                      <th class="px-6 py-3 font-bold text-left uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Export Name</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Status</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Files</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Size</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Created</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Completed</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for export in exports %}
                    <tr>
                      <td class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <div class="flex px-2 py-1">
                          <div class="flex flex-col justify-center">
                            <h6 class="mb-0 text-sm leading-normal dark:text-white">{{ export.export_name }}</h6>
                            {% if export.status == 'processing' %}
                              <span class="progress-indicator" title="Processing..."></span>
                            {% endif %}
                          </div>
                        </div>
                      </td>

                      <td class="p-2 text-sm leading-normal text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="bg-gradient-to-tl from-emerald-500 to-teal-400 px-2.5 text-xs rounded-1.8 py-1.4 inline-block whitespace-nowrap text-center align-baseline font-bold uppercase leading-none text-white">
                          {{ export.get_status_display }}
                        </span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">{{ export.total_files|default:"-" }}</span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">
                          {% if export.file_size %}
                            {{ export.file_size_mb|floatformat:1 }} MB
                          {% else %}
                            -
                          {% endif %}
                        </span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">
                          {{ export.created_at|date:"d M Y, h:i A" }}
                        </span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">
                          {% if export.status == 'completed' and export.updated_at %}
                            {{ export.updated_at|date:"d M Y, h:i A" }}
                          {% else %}
                            -
                          {% endif %}
                        </span>
                      </td>
                      <td class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <div class="flex flex-row items-center justify-center gap-4">
                          {% if export.status == 'completed' and export.download_url %}
                            <a href="{{ export.download_url }}" class="text-sm mr-2 font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">Download</a>
                          {% endif %}
                          <a onclick="toggleDetails({{ export.id }})" class="text-sm text-cyan-500 mr-2 font-semibold leading-tight dark:text-white dark:opacity-80">Details</a>
                          {% if export.status == 'processing' %}
                            <button onclick="cancelExport('{{ export.task_id }}')" class="text-sm text-red-600 font-semibold leading-tight dark:text-white dark:opacity-80 hover:text-red-800">
                              Cancel
                            </button>
                          {% endif %}
                        </div>
                      </td>
                    </tr>
                    <tr id="details-{{ export.id }}" style="display: none;">
                      <td colspan="7">
                        <div class="export-details">
                          <div class="detail-row">
                            <span class="detail-label">Task ID:</span>
                            <span class="detail-value">{{ export.task_id|truncatechars:20 }}</span>
                          </div>

                          {% if export.category_ids %}
                            <div class="detail-row">
                              <span class="detail-label">Categories:</span>
                              <div class="filters-list">
                                {% for cat_id in export.category_ids %}
                                  <span class="filter-tag">{{ cat_id }}</span>
                                {% endfor %}
                              </div>
                            </div>
                          {% endif %}

                          {% if export.applied_filters %}
                            <div class="detail-row">
                              <span class="detail-label">Filters Applied:</span>
                              <span class="detail-value">{{ export.applied_filters|truncatechars:100 }}</span>
                            </div>
                          {% endif %}

                          {% if export.folder_structure_json %}
                            {% load custom_filters %}
                            <div class="detail-row">
                              <span class="detail-label">Excel Path:</span>
                              <span class="detail-value">{{ export.folder_structure_json|json_get:"excel_path"|default:"-" }}</span>
                            </div>
                            <div class="detail-row">
                              <span class="detail-label">Audio Path:</span>
                              <span class="detail-value">{{ export.folder_structure_json|json_get:"audio_path"|default:"-" }}</span>
                            </div>
                          {% endif %}

                          {% if export.folder_structure_json and export.folder_structure_json.audio_structure_template %}
                            <div class="detail-row">
                              <span class="detail-label">Audio Template:</span>
                              <span class="detail-value">{{ export.folder_structure_json.audio_structure_template }}</span>
                            </div>
                          {% endif %}

                          {% if export.error_message %}
                            <div class="error-message">
                              <strong>Error:</strong> {{ export.error_message }}
                            </div>
                          {% endif %}
                        </div>
                      </td>
                    </tr>
                    {% empty %}
                    <tr>
                      <td colspan="7" class="p-4 text-center text-gray-500">
                        No exports found. <a href="{% url 'export:export_with_audio' %}" class="text-blue-500 text-sm hover:underline">Create your first export</a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>

              </div>

              <!-- Modern Pagination -->
              {% if is_paginated %}
              <div class="pagination-container  mx-2 mt-2">
                {% if page_obj.has_previous %}
                  <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.page_size %}&page_size={{ request.GET.page_size }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-double-left"></i>
                  </a>
                  <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.page_size %}&page_size={{ request.GET.page_size }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-left"></i>
                  </a>
                {% else %}
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-double-left"></i>
                  </span>
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-left"></i>
                  </span>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                  {% if num == page_obj.number %}
                    <span class="pagination-btn active">{{ num }}</span>
                  {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.page_size %}&page_size={{ request.GET.page_size }}{% endif %}"
                       class="pagination-btn">{{ num }}</a>
                  {% elif num == 1 or num == page_obj.paginator.num_pages %}
                    <a href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.page_size %}&page_size={{ request.GET.page_size }}{% endif %}"
                       class="pagination-btn">{{ num }}</a>
                  {% elif num == 2 and page_obj.number > 5 %}
                    <span class="pagination-dots">...</span>
                  {% elif num == page_obj.paginator.num_pages|add:'-1' and page_obj.number < page_obj.paginator.num_pages|add:'-4' %}
                    <span class="pagination-dots">...</span>
                  {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.page_size %}&page_size={{ request.GET.page_size }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-right"></i>
                  </a>
                  <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.page_size %}&page_size={{ request.GET.page_size }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-double-right"></i>
                  </a>
                {% else %}
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-right"></i>
                  </span>
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-double-right"></i>
                  </span>
                {% endif %}

                <div class="page-info">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </div>
              </div>
              {% endif %}

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Pagination Styling */
  .pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem !important;
    gap: 0.5rem;
  }

  .pagination-btn {
    padding: 0.5rem 0.75rem;
    border: 1px solid #e5e7eb;
    background: white;
    color: #6b7280;
    text-decoration: none;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 2.5rem;
  }

  .pagination-btn:hover:not(.disabled) {
    background: #667eea;
    color: white;
    border-color: #667eea;
  }

  .pagination-btn.active {
    background: #667eea;
    color: white;
    border-color: #667eea;
    font-weight: 600;
  }

  .pagination-btn.disabled {
    background: #f9fafb;
    color: #d1d5db;
    cursor: not-allowed;
  }

  .pagination-dots {
    padding: 0.5rem 0.75rem;
    color: #6b7280;
  }

  .page-info {
    margin-left: 1rem;
    color: #6b7280;
    font-size: 0.875rem;
  }

  /* SweetAlert2 Custom Styling */
  .swal2-popup {
    background: #ffffff;
    border-radius: 0.5rem;
    font-family: inherit;
  }

  .dark .swal2-popup {
    background: #1e293b;
    color: #ffffff;
  }

  .swal2-title {
    color: inherit;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .swal2-html-container {
    color: inherit;
  }

  .swal2-confirm {
    background-color: #ef4444 !important;
    color: white !important;
    border: none !important;
    border-radius: 0.375rem !important;
    padding: 0.5rem 1rem !important;
    font-weight: 500 !important;
    margin-right: 0.5rem !important;
    margin-left: 0.5rem !important;
  }

  .swal2-confirm:hover {
    background-color: #dc2626 !important;
  }
  .swal2-actions{
    width: 100%;
    display: flex;
    justify-content: end;
    gap: 5;
    padding-right: 10px;
  }

  .swal2-cancel {
    background-color: #e5e7eb !important;
    color: #374151 !important;
    border: none !important;
    border-radius: 0.375rem !important;
    padding: 0.5rem 1rem !important;
    font-weight: 500 !important;
  }

  .swal2-cancel:hover {
    background-color: #d1d5db !important;
  }

  .swal2-icon.swal2-warning {
    color: #ef4444 !important;
    border-color: #ef4444 !important;
  }
</style>

<script>
  function toggleDetails(exportId) {
    const detailsRow = document.getElementById(`details-${exportId}`);
    if (detailsRow.style.display === 'none') {
      detailsRow.style.display = 'table-row';
    } else {
      detailsRow.style.display = 'none';
    }
  }

  function cancelExport(taskId) {
    Swal.fire({
      title: 'Cancel Export?',
      html: `<span class="text-sm">Are you sure you want to cancel this export? This action cannot be undone.</span>`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Cancel Export',
      cancelButtonText: 'Keep Processing',
      confirmButtonColor: '#ef4444',
      cancelButtonColor: '#6b7280',
      reverseButtons: true,
      focusCancel: true,
      customClass: {
        popup: 'dark:bg-slate-800 dark:text-white',
        confirmButton: '!bg-red-600 hover:!bg-red-700 !text-white !px-4 !py-2 !rounded !mr-2',
        cancelButton: '!bg-gray-200 hover:!bg-gray-300 !text-gray-800 !px-4 !py-2 !rounded'
      },
      buttonsStyling: false
    }).then((result) => {
      if (result.isConfirmed) {
        // Here you would make an AJAX call to cancel the export
        // For now, just show a success message
        Swal.fire({
          icon: 'info',
          title: 'Cancellation Requested',
          text: 'The export cancellation has been requested. It may take a moment to take effect.',
          timer: 3000,
          showConfirmButton: false
        });
      }
    });
  }

  function clearFilter(filterName) {
    const url = new URL(window.location);
    url.searchParams.delete(filterName);
    window.location.href = url.toString();
  }

  // Auto-refresh for processing exports
  function checkProcessingExports() {
    const processingRows = document.querySelectorAll('tr:has(.status-processing)');
    if (processingRows.length > 0) {
      // Refresh every 30 seconds if there are processing exports
      setTimeout(() => {
        window.location.reload();
      }, 30000);
    }
  }

  // Check on page load
  checkProcessingExports();

  // Auto-submit form on filter change
  document.addEventListener('DOMContentLoaded', function() {
    const selects = document.querySelectorAll('.filter-select');
    selects.forEach(select => {
      select.addEventListener('change', function() {
        this.form.submit();
      });
    });
  });
</script>
{% endblock %}
