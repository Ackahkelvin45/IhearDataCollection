{% extends 'datacollection/layout.html'%}

{% block content %}
  <nav>
    <!-- breadcrumb -->
    <ol style="margin-bottom: 30px;" class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
      <li class="text-sm leading-normal">
        <a class="text-white opacity-50" href="javascript:;">home</a>
      </li>
      <li class="text-sm pl-2 capitalize leading-normal text-white before:float-left before:pr-2 before:text-white before:content-['/']" aria-current="page">Reports</li>
    </ol>
  </nav>

<div class="flex flex-wrap -mx-3">
  <!-- Card -->
  <div class="w-full px-6 py-6 mx-auto">
    <div class="w-full max-w-full">
      <div class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-xl
                  dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">

        <!-- Header -->
        <div class="p-4">
          <h6 class="mb-4 font-semibold text-lg">Query Parameters</h6>


          <!-- Group 1: Dataset Info -->
          <div class="flex flex-wrap -mx-2">
            <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
              <label class="block mb-1 text-sm font-medium text-slate-600">Dataset Type</label>
              <select name="dataset_type" type="text" placeholder="Enter value"
                class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
                <option>Select Dataset</option>
                {% for dataset in datasets %}
                <option>{{dataset.name}}</option>
                {%endfor%}
                </select>
            </div>

         <!-- Category -->
<!-- Category -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <label class="block mb-1 text-sm font-medium text-slate-600">Category</label>
  <select id="category" class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
    <option value="">Select Category</option>
    {% for category in categories %}
      <option value="{{ category.id }}">{{ category.name }}</option>
    {% endfor %}
  </select>
</div>

<!-- Class -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <label class="block mb-1 text-sm font-medium text-slate-600">Class</label>
  <select id="class" disabled class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
    <option value="">Select Class</option>
  </select>
</div>

<!-- Sub Class -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <label class="block mb-1 text-sm font-medium text-slate-600">Sub Class</label>
  <select id="subclass" disabled class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
    <option value="">Select Subclass</option>
  </select>
</div></div>



          <!-- Separator -->
          <hr class="my-4  border-primary bg-primary">

          <!-- Group 2: Location Info -->
          <div class="flex flex-wrap -mx-2">
          <!-- Region -->
<!-- Region -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <label class="block mb-1 text-sm font-medium text-slate-600">Region</label>
  <select id="region" class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
    <option value="">Select Region</option>
    {% for region in regions %}
      <option value="{{ region.id }}">{{ region.name }}</option>
    {% endfor %}
  </select>
</div>

<!-- Community -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <label class="block mb-1 text-sm font-medium text-slate-600">Community</label>
  <select id="community" disabled class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
    <option value="">Select Community</option>
  </select>
</div>



            <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
              <label class="block mb-1 text-sm font-medium text-slate-600">Time Of Day</label>
              <input type="text" placeholder="Enter value"
                class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
            </div>
          </div>

          <!-- Separator -->
          <hr class="my-4 border-gray-300">

          <!-- Group 3: Recording Info -->
          <div class="flex flex-wrap -mx-2">
            <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
              <label class="block mb-1 text-sm font-medium text-slate-600">Recording Date Range</label>
              <input type="text" placeholder="Enter value"
                class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
            </div>

            <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
              <label class="block mb-1 text-sm font-medium text-slate-600">Recording Device</label>
              <input type="text" placeholder="Enter value"
                class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">
            </div>

            <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
              <label class="block mb-1 text-sm font-medium text-slate-600">Microphone Type</label>
              <select type="text" placeholder="Enter value"
                class="focus:shadow-primary-outline text-sm block w-full rounded-lg border border-gray-300 px-3 py-2">

 <option value="">Select microphone type</option>
    {% for microphone in microphones %}
      <option value="{{ microphone.id }}">{{ microphone.name }}</option>
    {% endfor %}
                </select>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</div>

  <div class="flex flex-wrap -mx-3">
    <!-- card1 -->
    <div class="w-full px-6 py-6 mx-auto">
      <!-- table 1 -->
      <div class="flex flex-wrap -mx-3">
        <div class="flex-none w-full max-w-full px-3">
          <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 border-transparent border-solid shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">


            <div class="p-6 pb-0 mb-0 border-b-0 border-b-solid rounded-t-2xl border-b-transparent">
              <div class="flex justify-between items-center">


                <div>
                <h6 class="dark:text-white text-xl"> Dataset table</h6>

                  <div class="flex items-center mt-4 space-x-2 gap-2 ">
            <button class="inline-block px-6 py-3 mr-2 font-bold text-center text-primary uppercase align-middle transition-all bg-transparent border border-primary rounded-lg cursor-pointer leading-normal text-xs ease-in tracking-tight-rem shadow-xs bg-150 bg-x-25 hover:-translate-y-px active:opacity-85 hover:shadow-md">
  <i class="ni ni-single-copy-04 mr-2"></i> Export to PDF
</button>

<button class="inline-block px-6 py-3 mr-3 font-bold text-center text-primary uppercase align-middle transition-all bg-transparent border border-primary rounded-lg cursor-pointer leading-normal text-xs ease-in tracking-tight-rem shadow-xs bg-150 bg-x-25 hover:-translate-y-px active:opacity-85 hover:shadow-md">
  <i class="ni ni-collection mr-2"></i> Export to Excel
</button>

              </div>
                </div>
                <div class="text-sm text-gray-500 dark:text-gray-400">
                  Total: {{ paginator.count }} datasets
                </div>
              </div>
            </div>


            <div class="flex-auto px-0 pt-0 pb-2">
              <div class="p-0 overflow-x-auto">
                <table class="items-center w-full mb-0 align-top border-collapse dark:border-white/40 text-slate-500">
                  <thead class="align-bottom">
                    <tr>
                      <th class="px-6 py-3 font-bold text-left uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Noise ID</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Category</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Class</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Sub Class</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Recording Date</th>
                      <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-collapse shadow-none dark:border-white/40 dark:text-white text-xs border-b-solid tracking-none whitespace-nowrap text-slate-700 opacity-70">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for dataset in datasets %}
                    <tr>
                      <td class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <div class="flex px-2 py-1">
                          <div class="flex flex-col justify-center">
                            <h6 class="mb-0 text-sm leading-normal dark:text-white">{{ dataset.noise_id }}</h6>
                          </div>
                        </div>
                      </td>

                      <td class="p-2 text-sm leading-normal text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="bg-gradient-to-tl from-emerald-500 to-teal-400 px-2.5 text-xs rounded-1.8 py-1.4 inline-block whitespace-nowrap text-center align-baseline font-bold uppercase leading-none text-white">
                          {{ dataset.category }}
                        </span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">{{ dataset.class_name }}</span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">{{ dataset.subclass }}</span>
                      </td>
                      <td class="p-2 text-center align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <span class="text-sm font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">
                          {{ dataset.recording_date|date:"d M Y, h:i A" }}
                        </span>
                      </td>
                      <td class="p-2 align-middle bg-transparent border-b dark:border-white/40 whitespace-nowrap shadow-transparent">
                        <div class="flex flex-row items-center justify-center gap-4">
                          <a href="{% url 'data:noise_dataset_detail' dataset.id %}" class="text-sm mr-2 font-semibold leading-tight dark:text-white dark:opacity-80 text-slate-400">View</a>
                          <a  href="{% url 'data:noise_dataset_edit' dataset.id %}" class="text-sm text-cyan-500 mr-2 font-semibold leading-tight dark:text-white dark:opacity-80">Edit</a>
                          <button onclick="confirmDelete('{% url 'data:noise_dataset_delete' dataset.id %}', '{{ dataset.noise_id }}')"
                                  class="text-sm text-red-600 font-semibold leading-tight dark:text-white dark:opacity-80 hover:text-red-800">
                            Delete
                          </button>
                          {% csrf_token %}
                        </div>
                      </td>
                    </tr>
                    {% empty %}
                    <tr>
                      <td colspan="7" class="p-4 text-center text-gray-500">
                        No datasets found.
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>

              </div>

              <!-- Modern Pagination -->
              {% if is_paginated %}
              <div class="pagination-container  mx-2 mt-2">
                {% if page_obj.has_previous %}
                  <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.date_range %}&date_range={{ request.GET.date_range }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-double-left"></i>
                  </a>
                  <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.date_range %}&date_range={{ request.GET.date_range }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-left"></i>
                  </a>
                {% else %}
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-double-left"></i>
                  </span>
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-left"></i>
                  </span>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                  {% if num == page_obj.number %}
                    <span class="pagination-btn active">{{ num }}</span>
                  {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.date_range %}&date_range={{ request.GET.date_range }}{% endif %}"
                       class="pagination-btn">{{ num }}</a>
                  {% elif num == 1 or num == page_obj.paginator.num_pages %}
                    <a href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.date_range %}&date_range={{ request.GET.date_range }}{% endif %}"
                       class="pagination-btn">{{ num }}</a>
                  {% elif num == 2 and page_obj.number > 5 %}
                    <span class="pagination-dots">...</span>
                  {% elif num == page_obj.paginator.num_pages|add:'-1' and page_obj.number < page_obj.paginator.num_pages|add:'-4' %}
                    <span class="pagination-dots">...</span>
                  {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.date_range %}&date_range={{ request.GET.date_range }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-right"></i>
                  </a>
                  <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.date_range %}&date_range={{ request.GET.date_range }}{% endif %}"
                     class="pagination-btn">
                    <i class="fas fa-angle-double-right"></i>
                  </a>
                {% else %}
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-right"></i>
                  </span>
                  <span class="pagination-btn disabled">
                    <i class="fas fa-angle-double-right"></i>
                  </span>
                {% endif %}

                <div class="page-info">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </div>
              </div>
              {% endif %}

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>





  <script>
document.addEventListener("DOMContentLoaded", function() {
  let categorySelect = document.getElementById("category");
  let classSelect = document.getElementById("class");
  let subclassSelect = document.getElementById("subclass");
  let regionSelect = document.getElementById("region");
  let communitySelect = document.getElementById("community");

  // When Category changes → fetch Classes
  categorySelect.addEventListener("change", function() {
    let categoryId = this.value;
    classSelect.innerHTML = "<option value=''>Select Class</option>";
    subclassSelect.innerHTML = "<option value=''>Select Subclass</option>";
    subclassSelect.disabled = true;

    if (categoryId) {
      fetch(`/reports/dependent-dropdown/?category_id=${categoryId}`)
      .then(res => res.json())
      .then(data => {
        data.forEach(item => {
          classSelect.innerHTML += `<option value="${item.id}">${item.name}</option>`;
        });
        classSelect.disabled = false;
      });
    } else {
      classSelect.disabled = true;
    }
  });

  // When Class changes → fetch SubClasses
  classSelect.addEventListener("change", function() {
    let classId = this.value;
    subclassSelect.innerHTML = "<option value=''>Select Subclass</option>";

    if (classId) {
      fetch(`/reports/dependent-dropdown/?class_id=${classId}`)
      .then(res => res.json())
      .then(data => {
        data.forEach(item => {
          subclassSelect.innerHTML += `<option value="${item.id}">${item.name}</option>`;
        });
        subclassSelect.disabled = false;
      });
    } else {
      subclassSelect.disabled = true;
    }
  });

  // When Region changes → fetch Communities
  regionSelect.addEventListener("change", function() {
    let regionId = this.value;
    communitySelect.innerHTML = "<option value=''>Select Community</option>";

    if (regionId) {
      fetch(`/reports/dependent-dropdown/?region_id=${regionId}`)
      .then(res => res.json())
      .then(data => {
        data.forEach(item => {
          communitySelect.innerHTML += `<option value="${item.id}">${item.name}</option>`;
        });
        communitySelect.disabled = false;
      });
    } else {
      communitySelect.disabled = true;
    }
  });
});
</script>


  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}
